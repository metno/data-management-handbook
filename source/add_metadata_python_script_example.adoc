[[example-script-add-metadata]]
===== Example script to create a NetCDF-CF file

We use this test dataset containing the U component of wind `x_wind_10m` extracted from a MEPS 2.5km file: https://thredds.met.no/thredds/catalog/metusers/magnusu/test-2023-02-03/catalog.html?dataset=metusers/magnusu/test-2023-02-03/meps_reduced.nc

The below is an example python script to add discovery metadata to the netCDF-CF file. Note that we have only included the required attributes, and that the data producer should add the recommended ones as well. This is needed to support (meta)data interoperability. The resulting file can be validated by the script `scripts/nc2mmd.py` in https://github.com/metno/py-mmd-tools[py-mmd-tools], which also can parse the netCDF-CF file into an MMD xml file:
[source, python]
----
#!/usr/bin/env python

from datetime import datetime, timedelta, timezone
import sys
import netCDF4 as nc
from uuid import uuid4

with nc.Dataset(sys.argv[1], "a") as f:
    
    f.id = str(uuid4())
    
    f.title = 'U component of wind example'

    f.summary = 'test dataset created '
    f.summary += 'extracting x_wind_10m from '
    f.summary += 'a MEPS 2.5km dataset'


    f.keywords = 'GCMDSK:Earth Science > Atmosphere > Atmospheric winds, '
    f.keywords += 'GCMDLOC:Geographic Region > Northern Hemisphere, '
    f.keywords += (
                    'GEMET:Meteorological geographical features, '
                    'GEMET:Atmospheric conditions, '
                )
    f.keywords += (
                    'GEMET:Oceanographic geographical features, '
                    'NORTHEMES:Weather and climate'
                )
    
    f.keywords_vocabulary = 'GCMDSK:GCMD Science Keywords:https://gcmd.earthdata.nasa.gov/kms/concepts/concept_scheme/sciencekeywords, '
    f.keywords_vocabulary += 'GEMET:INSPIRE themes:https://inspire.ec.europa.eu/theme, '
    f.keywords_vocabulary += 'NORTHEMES:GeoNorge Themes:https://register.geonorge.no/subregister/metadata-kodelister/kartverket/nasjonal-temainndeling, '
    f.keywords_vocabulary += 'GCMDLOC:GCMD Locations:https://gcmd.earthdata.nasa.gov/kms/concepts/concept_scheme/locations'

    f.naming_authority = 'no.met'
    f.institution_short_name = 'MET Norway'

    # extracting f.time_coverage_start and f.time_coverage_end from the time variable
    first_time_step = f.variables['time'][0] # 1675242000 in this example
    last_time_step = f.variables['time'][-1] # 1675461600 in this example

    f.time_coverage_start = datetime.fromtimestamp(first_time_step).replace(tzinfo=timezone.utc).isoformat()
    f.time_coverage_end = datetime.fromtimestamp(last_time_step).replace(tzinfo=timezone.utc).isoformat()

    # the date_created is recorded in the 'history' field in this case 
    f.date_created = datetime.strptime("2023-02-01T11:30:05","%Y-%m-%dT%H:%M:%S").replace(tzinfo=timezone.utc).isoformat()
       
    # we update the conventions we are using   
    f.Conventions = 'CF-1.10, ACDD-1.3'

    f.iso_topic_category = 'climatologyMeteorologyAtmosphere'

    f.spatial_representation = 'grid'
----
