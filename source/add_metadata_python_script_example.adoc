[[example-script-add-metadata]]
===== Example script to add metadata to a netCDF file

The below is an example python script to add metadata to a netCDF-CF file. Note that we have only included the required attributes, and that the data producer should add more. This is needed to support (meta)data interoperability and can be validated by the script `scripts/nc2mmd.py` in https://github.com/metno/py-mmd-tools[py-mmd-tools], which also can parse the netCDF-CF file into an MMD xml file:
[source, python]
----
#!/usr/bin/env python

from datetime import datetime, timedelta, timezone
import sys
import netCDF4 as nc
from uuid import uuid4
import os

with nc.Dataset(sys.argv[1], "a") as f:
    f.id = str(uuid4())

    isotime_now = '{:%Y-%m-%dT%H:%M:%S}Z'.format(datetime.now(tz=timezone.utc))
    isotime_now_string = str(isotime_now)
    script_name = os.path.basename(__file__)
    
    if 'history' not in f.ncattrs():
        """ History should already exist in the netcdf file but if
        it does not, we create it here.
        """
        f.history = ""
        print("warning: no history field in the netCDF metadata")
    
    f.history += isotime_now_string + ", Dummy User, " + script_name + "\n" 


    f.title = 'lorem ipsum'

    f.summary = 'lorem ipsum '
    f.summary += 'lorem ipsum '
    f.summary += 'lorem ipsum'

    f.license = 'https://spdx.org/licenses/CC-BY-4.0(CC-BY-4.0)'

    # example keywords given here
    f.keywords = 'GCMDSK:Earth Science > Atmosphere > Atmospheric radiation, '
    f.keywords += 'GCMDLOC:Geographic Region > Northern Hemisphere, '
    f.keywords += (
                    'GEMET:Meteorological geographical features, '
                    'GEMET:Atmospheric conditions, '
                )
    f.keywords += (
                    'GEMET:Oceanographic geographical features, '
                    'NORTHEMES:Weather and climate'
                )
    f.keywords_vocabulary = (
                    'GCMDSK:GCMD Science Keywords:https://gcmd.'
                    'earthdata.nasa.gov/kms/concepts/concept_scheme/'
                    'sciencekeywords, '
                )
    f.keywords_vocabulary += (
                    'GEMET:INSPIRE themes:http://inspire.ec.europa.eu'
                    '/theme, '
                )
    f.keywords_vocabulary += (
                    'NORTHEMES:GeoNorge Themes:https://register.'
                    'geonorge.no/subregister/metadata-kodelister/'
                    'kartverket/nasjonal-temainndeling'
                )

    f.naming_authority = 'no.met'

    # only 1 timestep (e.g., one measurement) in this example
    # time of first measurement:
    coverstart = datetime(1900, 1, 1, 0, 0)  + timedelta(44012)
    coverend = coverstart  # time of last measurement

    f.time_coverage_start = '{:%Y-%m-%dT%H:%M:%S.%f}Z'.format(coverstart)
    f.time_coverage_end = '{:%Y-%m-%dT%H:%M:%S.%f}Z'.format(coverend)


    if 'created_date' in f.ncattrs() and 'created_hour' in f.ncattrs():
        """ It should be possible to get date_created from a
        pre-existing created_date and created_hour fields.
        """
        f.date_created = createddate = datetime.strptime(
            f.created_date + 'T' + f.created_hour, '%Y%m%dT%H%M%S.%f').replace(
                tzinfo = timezone.utc)
    else:
        # replace with the right value here:
        f.date_created = isotime_now

    f.Conventions = 'CF-1.6, ACDD-1.3'

    f.geospatial_lat_min = 30.05
    f.geospatial_lat_max = 81.95
    f.geospatial_lon_min = -29.95
    f.geospatial_lon_max = 89.95

    f.iso_topic_category = 'climatologyMeteorologyAtmosphere,environment'

    f.spatial_representation = 'grid'
----
